<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autenticando...</title>
  </head>
  <body>
    <p>Finalizando login com Discord, aguarde...</p>
    <script>
      (() => {
        const fragment = window.location.hash.substring(1);
        const params = new URLSearchParams(fragment);
        const accessToken = params.get('access_token');

        const goToApp = () => {
          const target = `tauri://localhost/#${fragment}`;
          try {
            window.location.replace(target);
          } catch (err) {
            // Fallback to href if replace isn't available
            window.location.href = target;
          }
        };

        if (accessToken) {
          // Persist token for web builds served over http/https
          try {
            localStorage.setItem('discord_token', accessToken);
          } catch {
            // ignore storage failures (e.g., blocked cookies)
          }

          // On desktop (Tauri), Discord only allows http/https redirects,
          // so we bounce back to the app scheme with the same fragment.
          if (window.location.protocol !== 'tauri:') {
            goToApp();
            return;
          }
        }

        window.location.replace('/');
      })();
    </script>
  </body>
</html>
